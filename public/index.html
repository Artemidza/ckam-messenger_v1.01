<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CKAM –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 1400px;
            height: 95vh;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            display: flex;
        }

        /* –õ–µ–≤—ã–π —Å–∞–π–¥–±–∞—Ä - Telegram —Å—Ç–∏–ª—å */
        .sidebar {
            width: 380px;
            background: #f0f2f5;
            border-right: 1px solid #e9edef;
            display: flex;
            flex-direction: column;
        }

        .profile-header {
            padding: 12px 16px;
            background: #0088cc;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #0088cc, #00a8ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .user-info {
            flex: 1;
            color: white;
        }

        .user-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .user-info p {
            font-size: 13px;
            opacity: 0.9;
        }

        .settings-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .settings-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .search-bar {
            padding: 12px 16px;
            background: white;
            border-bottom: 1px solid #e9edef;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            background: #f0f2f5;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            color: #333;
        }

        .search-input:focus {
            outline: none;
            background: #e5e9eb;
        }

        .chats-list {
            flex: 1;
            overflow-y: auto;
            background: white;
        }

        .chat-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f2f5;
            transition: background 0.2s;
        }

        .chat-item:hover {
            background: #f5f6f8;
        }

        .chat-item.active {
            background: #f0f7ff;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 20px;
            position: relative;
        }

        .online-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #00a884;
            border: 2px solid white;
            border-radius: 50%;
        }

        .chat-details {
            flex: 1;
            min-width: 0;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .chat-name {
            font-weight: 600;
            font-size: 15px;
            color: #111;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 12px;
            color: #667781;
            white-space: nowrap;
        }

        .chat-preview {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .last-message {
            font-size: 14px;
            color: #667781;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .unread-badge {
            background: #0088cc;
            color: white;
            font-size: 12px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –æ–∫–Ω–æ —á–∞—Ç–∞ */
        .chat-window {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #efeae2;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23e6e6e6' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .chat-header-bar {
            padding: 12px 16px;
            background: white;
            border-bottom: 1px solid #e9edef;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-info {
            flex: 1;
        }

        .chat-info h3 {
            font-size: 16px;
            font-weight: 600;
            color: #111;
            margin-bottom: 2px;
        }

        .chat-info p {
            font-size: 13px;
            color: #667781;
        }

        .chat-actions {
            display: flex;
            gap: 8px;
        }

        .chat-action-btn {
            background: transparent;
            border: none;
            color: #0088cc;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .chat-action-btn:hover {
            background: #f0f2f5;
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 8px;
            max-width: 65%;
            position: relative;
        }

        .message-incoming {
            margin-right: auto;
        }

        .message-outgoing {
            margin-left: auto;
        }

        .message-bubble {
            padding: 8px 12px;
            border-radius: 7.5px;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 1px 0.5px rgba(0,0,0,0.13);
        }

        .message-incoming .message-bubble {
            background: white;
            border-top-left-radius: 0;
        }

        .message-outgoing .message-bubble {
            background: #d9fdd3;
            border-top-right-radius: 0;
        }

        .message-sender {
            font-weight: 600;
            font-size: 14px;
            color: #0088cc;
            margin-bottom: 4px;
            padding-left: 12px;
        }

        .message-text {
            font-size: 14.2px;
            line-height: 1.4;
            color: #111;
        }

        .message-time {
            font-size: 11px;
            color: #667781;
            text-align: right;
            margin-top: 4px;
            margin-left: 8px;
            float: right;
        }

        .message-input-area {
            padding: 12px 16px;
            background: white;
            border-top: 1px solid #e9edef;
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            background: #f0f2f5;
            border: none;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.4;
            resize: none;
            max-height: 120px;
            min-height: 20px;
            outline: none;
        }

        .send-btn {
            background: #0088cc;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: #0077b3;
        }

        .send-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 20px 24px 16px;
            border-bottom: 1px solid #e9edef;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: #111;
        }

        .modal-body {
            padding: 20px 24px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: #0088cc;
        }

        .btn {
            padding: 12px 24px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
        }

        .btn:hover {
            background: #0077b3;
        }

        .btn-secondary {
            background: #f0f2f5;
            color: #0088cc;
        }

        .btn-secondary:hover {
            background: #e5e9eb;
        }

        .auth-switch {
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
            color: #667781;
        }

        .auth-switch a {
            color: #0088cc;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }

        .empty-chat {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #667781;
            text-align: center;
            padding: 40px;
        }

        .empty-chat h3 {
            font-size: 18px;
            font-weight: 600;
            color: #111;
            margin-bottom: 8px;
        }

        .invite-section {
            padding: 20px;
            background: #f0f7ff;
            border-top: 1px solid #e9edef;
        }

        .invite-section p {
            margin-bottom: 12px;
            color: #333;
            font-size: 14px;
        }

        .invite-link {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
            margin-bottom: 12px;
        }

        .copy-btn {
            background: #0088cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .copy-btn:hover {
            background: #0077b3;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-option {
            margin-bottom: 20px;
        }

        .settings-option h4 {
            margin-bottom: 12px;
            color: #111;
            font-size: 16px;
        }

        .color-options {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: #111;
        }

        .search-results {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e9edef;
            border-radius: 8px;
            margin-top: 12px;
        }

        .search-result-item {
            padding: 12px;
            border-bottom: 1px solid #e9edef;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .search-result-item:hover {
            background: #f5f6f8;
        }

        .search-result-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .search-result-info {
            flex: 1;
        }

        .search-result-name {
            font-weight: 600;
            color: #111;
        }

        .search-result-status {
            font-size: 12px;
            color: #667781;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #0088cc;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            display: none;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification:hover {
            background: #0077b3;
        }
    </style>
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ -->
    <div class="notification" id="notification" onclick="openNotificationChat()">
        <span>üí¨ –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</span>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div class="modal-overlay" id="loginModal" style="display: flex;">
        <div class="modal">
            <div class="modal-header">
                <h2>CKAM –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</h2>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="loginUsername" class="form-control" placeholder="demo" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div class="error-message" id="loginError">–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
                    <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
                </form>
                <div class="auth-switch">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="showRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </div>
                
                <div class="invite-section" style="margin-top: 20px; padding: 0; border: none;">
                    <p>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π:</p>
                    <div class="invite-link" id="inviteLink">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <button class="copy-btn" onclick="copyInviteLink()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal">
            <div class="modal-header">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="registerUsername" class="form-control" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerPassword" class="form-control" placeholder="–ù–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤" required>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerConfirmPassword" class="form-control" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    <div class="error-message" id="registerError"></div>
                    <button type="submit" class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </form>
                <div class="auth-switch">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a onclick="showLogin()">–í–æ–π—Ç–∏</a>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            </div>
            <div class="modal-body">
                <div class="settings-option">
                    <h4>–¶–≤–µ—Ç —Ç–µ–º—ã</h4>
                    <div class="color-options">
                        <div class="color-option" style="background: #0088cc;" onclick="changeThemeColor('#0088cc')"></div>
                        <div class="color-option" style="background: #ff6600;" onclick="changeThemeColor('#ff6600')"></div>
                        <div class="color-option" style="background: #9c27b0;" onclick="changeThemeColor('#9c27b0')"></div>
                        <div class="color-option" style="background: #e74c3c;" onclick="changeThemeColor('#e74c3c')"></div>
                        <div class="color-option" style="background: #2ecc71;" onclick="changeThemeColor('#2ecc71')"></div>
                    </div>
                </div>

                <div class="settings-option">
                    <h4>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h4>
                    <input type="text" id="userSearchInput" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" oninput="searchUsers()">
                    <div class="search-results" id="searchResults">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="settings-option">
                    <h4>–°–º–µ–Ω–∞ –∏–º–µ–Ω–∏</h4>
                    <input type="text" id="newUsername" class="form-control" placeholder="–ù–æ–≤–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                    <button class="btn" onclick="changeUsername()" style="margin-top: 8px;">–°–º–µ–Ω–∏—Ç—å –∏–º—è</button>
                </div>

                <div class="settings-option">
                    <h4>–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</h4>
                    <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
                </div>

                <button class="btn btn-secondary" onclick="closeSettings()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <div class="app-container" id="mainApp" style="display: none;">
        <!-- –õ–µ–≤—ã–π —Å–∞–π–¥–±–∞—Ä -->
        <div class="sidebar">
            <div class="profile-header">
                <div class="avatar" id="currentUserAvatar">U</div>
                <div class="user-info">
                    <h3 id="currentUsername">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                    <p id="userStatus">online</p>
                </div>
                <button class="settings-btn" onclick="showSettings()">‚öô</button>
            </div>

            <div class="search-bar">
                <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫" id="globalSearch">
            </div>

            <div class="chats-list" id="chatsList">
                <!-- –ß–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>

            <div class="invite-section">
                <p>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π:</p>
                <button class="copy-btn" onclick="copyInviteLink()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –æ–∫–Ω–æ —á–∞—Ç–∞ -->
        <div class="chat-window">
            <div id="emptyChat" class="empty-chat">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è</h3>
                <p>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å –¥—Ä—É–∑—å—è–º–∏</p>
            </div>

            <div id="activeChat" style="display: none; flex-direction: column; height: 100%;">
                <div class="chat-header-bar">
                    <div class="chat-avatar" id="activeChatAvatar">C</div>
                    <div class="chat-info">
                        <h3 id="activeChatName">–ß–∞—Ç</h3>
                        <p id="activeChatStatus">offline</p>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-action-btn">üìé</button>
                        <button class="chat-action-btn">üîç</button>
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>

                <div class="message-input-area">
                    <textarea class="message-input" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." rows="1"></textarea>
                    <button class="send-btn" id="sendButton" onclick="sendMessage()">‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        const SERVER_URL = window.location.origin;
        const USERS_KEY = 'ckam_users';
        const MESSAGES_KEY = 'ckam_messages';
        const CURRENT_USER_KEY = 'ckam_current_user';
        const THEME_COLOR_KEY = 'ckam_theme_color';

        let currentUser = null;
        let activeChat = null;
        let users = {};
        let messages = {};
        let lastMessageCheck = 0;

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function initApp() {
            initStorage();
            loadUsers();
            loadMessages();
            loadTheme();
            
            const savedUser = localStorage.getItem(CURRENT_USER_KEY);
            if (savedUser && users[savedUser]) {
                login(savedUser, users[savedUser].password);
            } else {
                showLogin();
            }
            
            startMessageChecker();
        }

        function initStorage() {
            if (!localStorage.getItem(USERS_KEY)) {
                const initialUsers = {
                    'demo': { password: 'demo', online: false, email: 'demo@example.com' },
                    'alex': { password: '123', online: false, email: 'alex@example.com' },
                    'maria': { password: '123', online: false, email: 'maria@example.com' },
                    'artem': { password: '123', online: false, email: 'artem@example.com' }
                };
                localStorage.setItem(USERS_KEY, JSON.stringify(initialUsers));
            }
            
            if (!localStorage.getItem(MESSAGES_KEY)) {
                const initialMessages = {
                    'demo_alex': [
                        { id: 1, sender: 'alex', receiver: 'demo', text: '–ü—Ä–∏–≤–µ—Ç!', timestamp: Date.now() - 3600000, read: true },
                        { id: 2, sender: 'demo', receiver: 'alex', text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?', timestamp: Date.now() - 3500000, read: true }
                    ]
                };
                localStorage.setItem(MESSAGES_KEY, JSON.stringify(initialMessages));
            }
        }

        function loadUsers() {
            users = JSON.parse(localStorage.getItem(USERS_KEY)) || {};
        }

        function saveUsers() {
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
        }

        function loadMessages() {
            messages = JSON.parse(localStorage.getItem(MESSAGES_KEY)) || {};
        }

        function saveMessages() {
            localStorage.setItem(MESSAGES_KEY, JSON.stringify(messages));
        }

        function loadTheme() {
            const color = localStorage.getItem(THEME_COLOR_KEY) || '#0088cc';
            applyThemeColor(color);
        }

        // ========== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==========
        function showLogin() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('inviteLink').textContent = getCurrentInviteLink();
        }

        function showRegister() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('registerModal').style.display = 'flex';
        }

        function login(username, password) {
            loadUsers();
            
            if (!users[username] || users[username].password !== password) {
                return false;
            }
            
            currentUser = username;
            users[username].online = true;
            users[username].lastSeen = Date.now();
            saveUsers();
            
            localStorage.setItem(CURRENT_USER_KEY, username);
            showMainApp();
            return true;
        }

        function register(username, password) {
            loadUsers();
            
            if (users[username]) {
                return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
            }
            
            users[username] = {
                password: password,
                online: true,
                lastSeen: Date.now(),
                email: `${username}@example.com`
            };
            
            saveUsers();
            return { success: true };
        }

        function logout() {
            if (currentUser && users[currentUser]) {
                users[currentUser].online = false;
                users[currentUser].lastSeen = Date.now();
                saveUsers();
            }
            
            currentUser = null;
            localStorage.removeItem(CURRENT_USER_KEY);
            showLogin();
        }

        // ========== –ò–ù–¢–ï–†–§–ï–ô–° ==========
        function showMainApp() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            updateUserInfo();
            updateChatList();
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('currentUsername').textContent = currentUser;
                document.getElementById('currentUserAvatar').textContent = currentUser.charAt(0).toUpperCase();
            }
        }

        function updateChatList() {
            const chatsList = document.getElementById('chatsList');
            chatsList.innerHTML = '';
            
            if (!currentUser) return;
            
            loadUsers();
            loadMessages();
            
            const otherUsers = Object.keys(users).filter(user => user !== currentUser);
            
            otherUsers.forEach(user => {
                const chatId = getChatId(currentUser, user);
                const chatMessages = messages[chatId] || [];
                const lastMessage = chatMessages[chatMessages.length - 1];
                const unreadCount = chatMessages.filter(m => 
                    m.receiver === currentUser && !m.read
                ).length;
                
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item' + (activeChat === user ? ' active' : '');
                chatItem.onclick = () => openChat(user);
                chatItem.innerHTML = `
                    <div class="chat-avatar">
                        ${user.charAt(0).toUpperCase()}
                        ${users[user].online ? '<div class="online-dot"></div>' : ''}
                    </div>
                    <div class="chat-details">
                        <div class="chat-header">
                            <div class="chat-name">${user}</div>
                            <div class="chat-time">${lastMessage ? formatTime(lastMessage.timestamp) : ''}</div>
                        </div>
                        <div class="chat-preview">
                            <div class="last-message">${lastMessage ? lastMessage.text : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}</div>
                            ${unreadCount > 0 ? `<div class="unread-badge">${unreadCount}</div>` : ''}
                        </div>
                    </div>
                `;
                chatsList.appendChild(chatItem);
            });
        }

        function openChat(user) {
            activeChat = user;
            
            document.getElementById('emptyChat').style.display = 'none';
            document.getElementById('activeChat').style.display = 'flex';
            document.getElementById('activeChatName').textContent = user;
            document.getElementById('activeChatAvatar').textContent = user.charAt(0).toUpperCase();
            document.getElementById('activeChatStatus').textContent = users[user]?.online ? 'online' : 'offline';
            
            loadMessagesForChat(user);
            markMessagesAsRead(user);
        }

        function loadMessagesForChat(user) {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';
            
            const chatId = getChatId(currentUser, user);
            const chatMessages = messages[chatId] || [];
            
            chatMessages.forEach(msg => {
                addMessageToUI(msg);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function addMessageToUI(msg) {
            const container = document.getElementById('messagesContainer');
            const isOutgoing = msg.sender === currentUser;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.innerHTML = `
                ${!isOutgoing ? `<div class="message-sender">${msg.sender}</div>` : ''}
                <div class="message-bubble">
                    <div class="message-text">${msg.text}</div>
                    <div class="message-time">${formatTime(msg.timestamp)}</div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentUser || !activeChat) return;
            
            const message = {
                id: Date.now(),
                sender: currentUser,
                receiver: activeChat,
                text: text,
                timestamp: Date.now(),
                read: false
            };
            
            const chatId = getChatId(currentUser, activeChat);
            if (!messages[chatId]) messages[chatId] = [];
            messages[chatId].push(message);
            saveMessages();
            
            addMessageToUI(message);
            updateChatList();
            
            input.value = '';
            input.style.height = 'auto';
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            simulateResponse();
        }

        function simulateResponse() {
            if (!activeChat) return;
            
            setTimeout(() => {
                const responses = [
                    "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
                    "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ...",
                    "–Ø –ø–æ–ª—É—á–∏–ª —Ç–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
                    "–°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!",
                    "–î–∞–≤–∞–π –ø—Ä–æ–¥–æ–ª–∂–∏–º –æ–±—â–µ–Ω–∏–µ"
                ];
                
                const responseText = responses[Math.floor(Math.random() * responses.length)];
                const message = {
                    id: Date.now() + 1,
                    sender: activeChat,
                    receiver: currentUser,
                    text: responseText,
                    timestamp: Date.now(),
                    read: false
                };
                
                const chatId = getChatId(currentUser, activeChat);
                if (!messages[chatId]) messages[chatId] = [];
                messages[chatId].push(message);
                saveMessages();
                
                if (activeChat === document.getElementById('activeChatName').textContent) {
                    addMessageToUI(message);
                }
                
                updateChatList();
                showNotification(activeChat, responseText);
            }, 1000 + Math.random() * 2000);
        }

        // ========== –ü–û–ò–°–ö –ò –ù–ê–°–¢–†–û–ô–ö–ò ==========
        function showSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function searchUsers() {
            const query = document.getElementById('userSearchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsDiv.innerHTML = '';
                return;
            }
            
            loadUsers();
            const results = Object.keys(users)
                .filter(user => user !== currentUser && user.toLowerCase().includes(query))
                .map(user => ({ username: user, online: users[user].online }));
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #667781;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            let html = '';
            results.forEach(user => {
                html += `
                    <div class="search-result-item" onclick="startChatWith('${user.username}')">
                        <div class="search-result-avatar">${user.username.charAt(0).toUpperCase()}</div>
                        <div class="search-result-info">
                            <div class="search-result-name">${user.username}</div>
                            <div class="search-result-status">${user.online ? 'online' : 'offline'}</div>
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function startChatWith(username) {
            closeSettings();
            openChat(username);
        }

        function changeThemeColor(color) {
            localStorage.setItem(THEME_COLOR_KEY, color);
            applyThemeColor(color);
        }

        function applyThemeColor(color) {
            const root = document.documentElement;
            root.style.setProperty('--primary-color', color);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å primary —Ü–≤–µ—Ç–æ–º
            const primaryElements = document.querySelectorAll('.btn:not(.btn-secondary), .send-btn, .chat-avatar, .avatar');
            primaryElements.forEach(el => {
                el.style.background = color;
            });
        }

        function changeUsername() {
            const newUsername = document.getElementById('newUsername').value.trim();
            if (!newUsername || !currentUser) return;
            
            if (newUsername === currentUser) {
                alert('–≠—Ç–æ —É–∂–µ –≤–∞—à–µ —Ç–µ–∫—É—â–µ–µ –∏–º—è!');
                return;
            }
            
            if (users[newUsername]) {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                return;
            }
            
            users[newUsername] = users[currentUser];
            delete users[currentUser];
            saveUsers();
            
            currentUser = newUsername;
            localStorage.setItem(CURRENT_USER_KEY, newUsername);
            
            updateUserInfo();
            alert('–ò–º—è —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–æ!');
            document.getElementById('newUsername').value = '';
        }

        // ========== –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ==========
        function showNotification(user, message) {
            const notification = document.getElementById('notification');
            notification.querySelector('span').textContent = `üí¨ ${user}: ${message.substring(0, 30)}${message.length > 30 ? '...' : ''}`;
            notification.style.display = 'flex';
            notification.dataset.user = user;
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        function openNotificationChat() {
            const user = document.getElementById('notification').dataset.user;
            if (user) {
                openChat(user);
                document.getElementById('notification').style.display = 'none';
            }
        }

        function startMessageChecker() {
            setInterval(() => {
                const now = Date.now();
                if (now - lastMessageCheck > 1000) {
                    checkForNewMessages();
                    lastMessageCheck = now;
                }
            }, 1000);
        }

        function checkForNewMessages() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            // –°–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
            updateChatList();
        }

        function markMessagesAsRead(user) {
            const chatId = getChatId(currentUser, user);
            const chatMessages = messages[chatId] || [];
            
            chatMessages.forEach(msg => {
                if (msg.receiver === currentUser) {
                    msg.read = true;
                }
            });
            
            saveMessages();
            updateChatList();
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function getChatId(user1, user2) {
            return [user1, user2].sort().join('_');
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
        }

        function getCurrentInviteLink() {
            return window.location.href.split('?')[0];
        }

        function copyInviteLink() {
            const link = getCurrentInviteLink();
            navigator.clipboard.writeText(link).then(() => {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            });
        }

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ==========
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (login(username, password)) {
                document.getElementById('loginError').style.display = 'none';
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                document.getElementById('registerError').textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                document.getElementById('registerError').style.display = 'block';
                return;
            }
            
            if (password.length < 6) {
                document.getElementById('registerError').textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤';
                document.getElementById('registerError').style.display = 'block';
                return;
            }
            
            const result = register(username, password);
            if (result.success) {
                login(username, password);
                document.getElementById('registerError').style.display = 'none';
            } else {
                document.getElementById('registerError').textContent = result.message;
                document.getElementById('registerError').style.display = 'block';
            }
        });

        document.getElementById('messageInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        document.getElementById('messageInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ========== –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ==========
        window.onload = initApp;
    </script>
</body>
</html>
